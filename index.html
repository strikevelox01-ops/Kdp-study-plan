<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FocusFlow Pro | Ultimate Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0b0e14;
            --surface: #161b22;
            --primary: #58a6ff;
            --secondary: #d29922;
            --success: #3fb950;
            --danger: #f85149;
            --text: #c9d1d9;
            --text-dim: #8b949e;
            --glow: 0 0 15px rgba(88, 166, 255, 0.3);
            --radius: 16px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text); min-height: 100vh; display: flex; justify-content: center; overflow-x: hidden; }

        .app-container { width: 100%; max-width: 480px; padding: 20px; padding-bottom: 120px; position: relative; }

        /* --- LEVEL SYSTEM --- */
        .level-card {
            background: linear-gradient(135deg, #1f2937, #111827);
            padding: 20px; border-radius: var(--radius); border: 1px solid #30363d; margin-bottom: 25px;
        }
        .xp-bar { width: 100%; height: 8px; background: #30363d; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .xp-progress { height: 100%; background: var(--primary); box-shadow: var(--glow); transition: width 0.5s ease; }

        /* --- VIEWS --- */
        .view { display: none; animation: slideUp 0.3s ease-out; }
        .view.active { display: block; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- SUBJECT CARDS --- */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card {
            background: var(--surface); border: 1px solid #30363d; border-radius: var(--radius);
            padding: 18px; position: relative; transition: 0.2s; cursor: pointer;
        }
        .card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .badge { position: absolute; top: -10px; right: -10px; background: var(--secondary); color: black; 
                 font-size: 10px; font-weight: 800; padding: 4px 8px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }

        /* --- ANALYTICS MODAL --- */
        .modal {
            position: fixed; inset: 0; background: var(--bg); z-index: 2000;
            padding: 20px; display: none; overflow-y: auto;
        }
        .modal.active { display: block; }

        /* --- TIMER --- */
        .timer-circle {
            width: 240px; height: 240px; border-radius: 50%; border: 8px solid #30363d;
            margin: 40px auto; display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; border-top-color: var(--primary); animation: spin 2s linear infinite; animation-play-state: paused;
        }
        .timer-circle.running { animation-play-state: running; }
        .time-val { font-size: 48px; font-weight: 800; font-variant-numeric: tabular-nums; color: white; }
        @keyframes spin { from { border-top-color: var(--primary); } to { border-top-color: var(--secondary); } }

        /* --- FORM ELEMENTS --- */
        input, select { 
            width: 100%; padding: 14px; background: #0d1117; border: 1px solid #30363d;
            border-radius: 10px; color: white; margin-bottom: 15px; font-size: 16px;
        }
        .btn { 
            width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: 700;
            cursor: pointer; transition: 0.2s; font-size: 15px;
        }
        .btn-primary { background: var(--primary); color: #0d1117; margin-bottom: 10px; }
        .btn-outline { background: transparent; border: 1px solid #30363d; color: var(--text-dim); }

        /* --- BOTTOM NAV --- */
        nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; background: rgba(22, 27, 34, 0.95);
            backdrop-filter: blur(10px); padding: 14px; border-radius: 25px;
            display: flex; justify-content: space-around; border: 1px solid #30363d; z-index: 1000;
        }
        .nav-item { font-size: 22px; cursor: pointer; opacity: 0.4; transition: 0.3s; }
        .nav-item.active { opacity: 1; transform: translateY(-5px); color: var(--primary); }

        /* --- NOTIFICATION POPUP --- */
        #notif {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: var(--success); color: white; padding: 12px 24px; border-radius: 30px;
            font-weight: 700; display: none; z-index: 3000; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

<div id="notif">XP GAINED! üöÄ</div>

<div class="app-container">
    
    <div id="dashView" class="view active">
        <header style="margin-bottom: 20px;">
            <p id="dateLabel" style="color: var(--text-dim); font-size: 13px;"></p>
            <h1 id="userName">Commander</h1>
        </header>

        <div class="level-card">
            <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                <h3 style="color: var(--secondary)">Level <span id="userLvl">1</span></h3>
                <span style="font-size: 12px; color: var(--text-dim)" id="xpText">0 / 100 XP</span>
            </div>
            <div class="xp-bar"><div class="xp-progress" id="xpBar" style="width: 0%"></div></div>
        </div>

        <h3 style="margin-bottom: 15px; display: flex; justify-content: space-between;">
            Subjects <span style="font-size: 12px; color: var(--primary)" onclick="ui.nav('addView')">+ New</span>
        </h3>
        <div class="grid" id="subjectGrid"></div>

        <h3 style="margin-top: 30px; margin-bottom: 15px;">Focus History</h3>
        <div id="historyLog" style="display: flex; flex-direction: column; gap: 10px;"></div>
    </div>

    <div id="timerView" class="view">
        <h2 style="text-align: center;">Deep Focus Session</h2>
        <div class="timer-circle" id="circle">
            <div class="time-val" id="display">25:00</div>
            <p style="font-size: 10px; color: var(--text-dim); margin-top: 5px;">STAY FOCUSED</p>
        </div>

        <div style="padding: 0 40px;">
            <label style="font-size: 12px; color: var(--text-dim);">Session Length (Minutes)</label>
            <input type="number" id="timerInp" value="25" onchange="timer.sync()">
            <button class="btn btn-primary" id="timerBtn" onclick="timer.toggle()">Start Deep Work</button>
            <button class="btn btn-outline" onclick="timer.reset()">Reset</button>
        </div>
    </div>

    <div id="addView" class="view">
        <h2>Add Curriculum</h2>
        <div style="margin-top: 25px;">
            <input type="text" id="addName" placeholder="Subject Name">
            <input type="number" id="addMods" placeholder="Total Modules/Chapters">
            <select id="addType">
                <option value="STEM">STEM (Math/Science)</option>
                <option value="Humanities">Humanities/Art</option>
                <option value="Language">Languages</option>
                <option value="Tech">Technical/Coding</option>
            </select>
            <button class="btn btn-primary" onclick="core.addSubject()">Initialize Subject</button>
            <button class="btn btn-outline" onclick="ui.nav('dashView')">Cancel</button>
        </div>
    </div>

    <div id="modal" class="modal">
        <button class="btn btn-outline" onclick="ui.closeModal()" style="width: auto; margin-bottom: 20px;">‚Üê Close</button>
        <h1 id="mTitle">Subject</h1>
        <div style="background: var(--surface); padding: 20px; border-radius: 15px; margin: 20px 0;">
            <canvas id="subChart"></canvas>
        </div>
        <div id="mMeta" style="color: var(--text-dim); line-height: 1.6;"></div>
        <button class="btn" style="background: #3e1212; color: #f85149; margin-top: 40px;" onclick="core.deleteActive()">Terminate Subject</button>
    </div>

    <div id="settingsView" class="view">
        <h2>System Profile</h2>
        <div style="margin-top: 25px;">
            <label>Name</label>
            <input type="text" id="nameInp" onchange="core.saveName()">
            <button class="btn btn-outline" onclick="core.wipe()" style="color: var(--danger)">Purge All Storage</button>
        </div>
    </div>

    <nav>
        <div class="nav-item active" onclick="ui.nav('dashView', this)">üè†</div>
        <div class="nav-item" onclick="ui.nav('timerView', this)">‚è±Ô∏è</div>
        <div class="nav-item" onclick="ui.nav('settingsView', this)">‚öôÔ∏è</div>
    </nav>
</div>

<script>
    // --- STATE ENGINE ---
    const state = {
        user: localStorage.getItem('ff_name') || 'Scholar',
        xp: parseInt(localStorage.getItem('ff_xp')) || 0,
        lvl: parseInt(localStorage.getItem('ff_lvl')) || 1,
        subjects: JSON.parse(localStorage.getItem('ff_subjects')) || [],
        history: JSON.parse(localStorage.getItem('ff_hist')) || [],
        activeId: null,
        chart: null
    };

    // --- CORE LOGIC ---
    const core = {
        addSubject() {
            const name = document.getElementById('addName').value;
            const mods = document.getElementById('addMods').value;
            const type = document.getElementById('addType').value;
            if(!name || !mods) return;

            state.subjects.push({
                id: Date.now(),
                name, mods, type,
                done: 0,
                color: type === 'STEM' ? '#58a6ff' : '#d29922',
                data: [0,0,0,0,0,0,0]
            });
            this.save();
            ui.render();
            ui.nav('dashView');
            ui.notify("NEW SUBJECT ADDED");
        },

        updateXP(amt) {
            state.xp += amt;
            if(state.xp >= 100) {
                state.xp = 0;
                state.lvl++;
                ui.notify("LEVEL UP! Lvl " + state.lvl);
            }
            this.save();
            ui.render();
        },

        increment(id, e) {
            e.stopPropagation();
            const s = state.subjects.find(x => x.id === id);
            if(s.done < s.mods) {
                s.done++;
                s.data[new Date().getDay()]++;
                this.updateXP(20);
                this.save();
                ui.render();
            }
        },

        deleteActive() {
            state.subjects = state.subjects.filter(x => x.id !== state.activeId);
            this.save();
            ui.closeModal();
            ui.render();
        },

        saveName() { state.user = document.getElementById('nameInp').value; this.save(); ui.render(); },
        save() {
            localStorage.setItem('ff_name', state.user);
            localStorage.setItem('ff_xp', state.xp);
            localStorage.setItem('ff_lvl', state.lvl);
            localStorage.setItem('ff_subjects', JSON.stringify(state.subjects));
            localStorage.setItem('ff_hist', JSON.stringify(state.history));
        },
        wipe() { if(confirm("Purge system?")) { localStorage.clear(); location.reload(); } }
    };

    // --- UI CONTROLLER ---
    const ui = {
        nav(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                el.classList.add('active');
            }
        },

        render() {
            const grid = document.getElementById('subjectGrid');
            const hist = document.getElementById('historyLog');
            grid.innerHTML = ""; hist.innerHTML = "";
            
            document.getElementById('userName').innerText = "Hi, " + state.user;
            document.getElementById('nameInp').value = state.user;
            document.getElementById('userLvl').innerText = state.lvl;
            document.getElementById('xpText').innerText = state.xp + " / 100 XP";
            document.getElementById('xpBar').style.width = state.xp + "%";

            state.subjects.forEach(s => {
                grid.innerHTML += `
                    <div class="card" onclick="ui.openModal(${s.id})">
                        ${s.done == s.mods ? '<span class="badge">MAX</span>' : ''}
                        <div style="color:${s.color}; font-size:12px; font-weight:800; margin-bottom:5px;">${s.type}</div>
                        <strong>${s.name}</strong>
                        <p style="font-size:11px; color:var(--text-dim); margin-top:5px;">${s.done}/${s.mods} Modules</p>
                        <button onclick="core.increment(${s.id}, event)" style="margin-top:12px; width:100%; padding:6px; border-radius:6px; border:none; background:#30363d; color:white; font-size:10px;">+ PROGRESS</button>
                    </div>
                `;
            });

            state.history.slice(-3).reverse().forEach(h => {
                hist.innerHTML += `<div style="font-size:12px; color:var(--text-dim); padding:10px; border-left:2px solid var(--primary); background:var(--surface)">${h}</div>`;
            });
        },

        openModal(id) {
            state.activeId = id;
            const s = state.subjects.find(x => x.id === id);
            document.getElementById('modal').classList.add('active');
            document.getElementById('mTitle').innerText = s.name;
            document.getElementById('mMeta').innerText = `Category: ${s.type}\nCompletion: ${Math.round((s.done/s.mods)*100)}%`;
            
            const ctx = document.getElementById('subChart').getContext('2d');
            if(state.chart) state.chart.destroy();
            state.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['M','T','W','T','F','S','S'],
                    datasets: [{ label: 'Modules', data: s.data, backgroundColor: s.color }]
                },
                options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });
        },

        closeModal() { document.getElementById('modal').classList.remove('active'); },
        
        notify(msg) {
            const el = document.getElementById('notif');
            el.innerText = msg; el.style.display = 'block';
            setTimeout(() => { el.style.display = 'none'; }, 2000);
        }
    };

    // --- TIMER SYSTEM ---
    const timer = {
        seconds: 1500,
        running: false,
        interval: null,

        sync() { this.seconds = document.getElementById('timerInp').value * 60; this.draw(); },
        toggle() {
            if(this.running) {
                clearInterval(this.interval);
                document.getElementById('timerBtn').innerText = "Resume Session";
                document.getElementById('circle').classList.remove('running');
            } else {
                this.interval = setInterval(() => this.tick(), 1000);
                document.getElementById('timerBtn').innerText = "Pause Session";
                document.getElementById('circle').classList.add('running');
            }
            this.running = !this.running;
        },
        tick() {
            if(this.seconds <= 0) {
                clearInterval(this.interval);
                state.history.push("Finished " + document.getElementById('timerInp').value + "m session");
                core.updateXP(50);
                ui.notify("FOCUS COMPLETE +50XP");
                this.reset();
                return;
            }
            this.seconds--; this.draw();
        },
        draw() {
            const m = Math.floor(this.seconds / 60);
            const s = this.seconds % 60;
            document.getElementById('display').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        },
        reset() { clearInterval(this.interval); this.running = false; this.sync(); document.getElementById('timerBtn').innerText = "Start Deep Work"; document.getElementById('circle').classList.remove('running'); }
    };

    window.onload = () => {
        document.getElementById('dateLabel').innerText = new Date().toDateString().toUpperCase();
        ui.render();
    };
</script>
</body>
</html>
